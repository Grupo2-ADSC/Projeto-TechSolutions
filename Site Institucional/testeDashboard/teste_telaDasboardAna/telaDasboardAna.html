<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./telaDashboardAna.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }
    </style>

</head>

<body style="display: flex;">

    <nav id="menuLateral">
        <div class="seila">
            <!-- <p><img id="imgPerfil" src="./assets/imgPerfil.png" alt=""></p> essa aqui é a img com borda preta -->
            <p><img id="imgPerfil" src="./assetsAna/imgPerf.png" alt=""></p>

            <p>Bem Vindo!</p>
            <div class="seila2">
                <a href="#"><span class="material-symbols-outlined"> monitoring</span> - Dashboard</a>
            </div>

            <div class="seila2">
                <a href="#"> <span class="material-symbols-outlined">warehouse</span> - Armazém</a>
            </div>

            <div class="seila2">
                <a href="#"> <span class="material-symbols-outlined">groups</span> - Funcionário</a>
            </div>
            
            <br> <br><br>

            <button id="buttonDeslogar">Sair</button>
        </div>
    </nav>

    <div class="conteudo_metricas_graficos">

        <div class="metricas">

            <div class="quadrado_vermelho"><p>0 á 20</p></div>
            <div class="quadrado_laranja"><p>21 á 41</p></div>
            <div class="quadrado_amarelo"><p>42 á 63</p></div>
            <div class="quadrado_verde"><p>64 á 66</p></div>
            <div class="quadrado_amarelo"><p>67 á 68</p></div>
            <div class="quadrado_laranja"><p>78 á 88</p></div>
            <div class="quadrado_vermelho"><p>89 á 100</p></div>
    
       </div>
    
       <div class="graficos_container">  
            <canvas id="myChart" style="position: relative; height:10vh; width:10vw"></canvas>
            <canvas id="myChart2" style="position: relative; height:10vh; width:10vw"></canvas>
            <canvas id="dht11Umidade" style="position: relative; height: 10vh; width: 10vh;"></canvas>
       </div>

    </div>
   
         
    
</body>

<script>
   const labels =[
   "10:00",
   "11:00",
   "12:00",
   "13:00",
   "14:00",
   "15:00",
];
    const data ={
    labels: labels,
    datasets: [{
        label: 'Armazem 1',
        backgroundColor: '#004aad',
        borderColor: '#004aad',
        data: [95,66,59,70,25,89], 
    },
    {
        label: 'Armazem 2 ',
        backgroundColor: '#ff914d',
        borderColor: '#ff914d',
        data: [67,55,89,44,66,63],
    }]
};
    const config ={
    type: 'line',
    data: data,
    options: {}
};


    const labels2 =[
   "10:00",
   "11:00",
   "12:00",
   "13:00",
   "14:00",
   "15:00",
];
    const data2 ={
    labels: labels2,
    datasets: [{
        label: 'Armazem 1',
        backgroundColor: '#004aad',
        data: [95,66,59,70,25,89], 
    },
    {
        label: 'Armazem 2 ',
        backgroundColor: '#ff914d',
        data: [67,55,89,44,66,63],
    }]
};
    const config2 ={
    type: 'bar',
    data: data2,
    options: {}
};


    const labels3 =[
    "15 Vermelhos", 
    "3 Amarelos", 
    "1 Vermelho", 
    "2 Laranjas"
];
    const data3 = {
    labels: labels3,
        datasets: [{
        label: 'Alertas',
        backgroundColor: ['#00bf63', '#ffc857', '#ff3131', '#ff914d'], 
        data: [15, 3, 1, 2],
    }],
};
   const config3 ={
    type: 'doughnut', 
    data: data3,
    options: {}
   };

</script>


<script>

    /* -- dht11Umidade -- */
    var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
        contextoDht11Umidade.canvas.width = 1000;
        contextoDht11Umidade.canvas.height = 300;
        var dht11Umidade = new Chart(
            contextoDht11Umidade,
            {
                type: 'line',
                data: {
                    labels: ["10:00","10:30","11:00","11:30","12:00","12:30","10:30","11:00","11:30","12:00","12:30","10:30","11:00","11:30","12:00","12:30"],
                    datasets: [{
                        label: 'Umidade',
                        type: 'line',
                        borderColor: ['#45b3e7'],
                        fill: false                        
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Umidade'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


        var paginacao = {};
        var tempo = {};
        function obterDados(grafico, endpoint) {
            var http = new XMLHttpRequest();
            http.open('GET', 'http://localhost:3000/sensores/' + endpoint, false);
            http.send(null);
            var valores = JSON.parse(http.responseText);
            if (paginacao[endpoint] == null) {
                paginacao[endpoint] = 0;
            }
            if (tempo[endpoint] == null) {
                tempo[endpoint] = 0;
            }
            // Exibir à partir do último elemento exibido anteriormente
            var ultimaPaginacao = paginacao[endpoint];
            paginacao[endpoint] = valores.length;
            var valores = valores.slice(ultimaPaginacao);
            valores.forEach((valor) => {
                //Máximo de 60 itens exibidos no gráfico
                if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                    grafico.data.labels.shift();
                    grafico.data.datasets[0].data.shift();
                }

                grafico.data.labels.push(tempo[endpoint]++);
                grafico.data.datasets[0].data.push(parseFloat(valor));
                grafico.update();
            })
        }

        setInterval(() => {
            obterDados(dht11Umidade, 'dht11/umidade');
            obterDados(dht11Temperatura, 'dht11/temperatura');
            obterDados(luminosidade, 'luminosidade');
            obterDados(lm35Temperatura, 'lm35/temperatura');
            obterDados(chave, 'chave');
        }, 1000);

    </script>

</script>


<script>
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );
    const myChart2 = new Chart(
        document.getElementById('myChart2'),
        config2
    );
    const myChart3 = new Chart(
        document.getElementById('myChart3'),
        config3
    );
</script>

</html>


     